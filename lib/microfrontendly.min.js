!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("microfrontendly",[],t):"object"==typeof exports?exports.microfrontendly=t():e.microfrontendly=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";n.r(t),n.d(t,"Microfrontendly",(function(){return a})),n.d(t,"loadMicroApp",(function(){return d})),n.d(t,"getMicroAppConfigByName",(function(){return o})),n.d(t,"getMicroAppConfigByPath",(function(){return r}));var r=function(e,t){var n=e.split("/");if(n&&n[1])return t.apps.find((function(e){return e.componentName===n[1]}))},o=function(e,t){return t.apps.find((function(t){return t.componentName===e}))};window.__loadedScripts=[],window.__loadedStyles=[];var i=function(e){var t=e.src,n=e.selector;if(window.__loadedScripts.includes(n))return Promise.resolve({message:"[microapp-shell] "+n+" app had been loaded before"});var r=document.createElement("script");return r.setAttribute("src",t),r.setAttribute("id",n),new Promise((function(e,t){var o=function(){var t;r.removeEventListener("load",o),t=n,window.__loadedScripts.includes(t)||window.__loadedScripts.push(t),e({message:"[microapp-shell] "+n+" app has been just loaded"})},i=function(){r.removeEventListener("error",i),t({message:"[microapp-shell] "+n+" app has not been loaded"})};r.addEventListener("load",o),r.addEventListener("error",i),document.body.appendChild(r)}))},s=function(e){var t=e.src,n=e.selector;if(window.__loadedStyles.includes(n))return Promise.resolve({message:"[microapp-shell] "+n+" stylesheet had been loaded before"});var r=document.createElement("link");return r.setAttribute("type","text/css"),r.setAttribute("rel","stylesheet"),r.setAttribute("href",t),new Promise((function(e,t){var o=function(){var t;r.removeEventListener("load",o),t=n,window.__loadedStyles.includes(t)||window.__loadedStyles.push(t),e({message:"[microapp-shell] "+n+" stylesheet has been just loaded"})},i=function(){r.removeEventListener("error",i),t({message:"[microapp-shell] "+n+" stylesheet has not been loaded"})};r.addEventListener("load",o),r.addEventListener("error",i),document.head.appendChild(r)}))},d=function(e){var t=e.host;if(!t)throw{message:"Source host is not specified"};var n=e.selector,r=[],o=i({src:t+"/"+e.sources.entryJs,selector:n});if(r.push(o),e.sources.entryStyle){var d=s({src:t+"/"+e.sources.entryStyle,selector:n});r.push(d)}return Promise.all(r).then((function(t){return t.forEach((function(e){return console.info(e.message)})),e}))},u=function(e,t){e&&t&&d(t).then((function(t){var n=t.selector;if(!e.hasChildNodes()){var r=document.createElement(n);return t.properties&&Object.keys(t.properties).map((function(e){r[e]=t.properties[e]})),e.append(r),t}return function(e,t){return e.firstChild.nodeName.toUpperCase()===t.toUpperCase()}(e,n)||(e.removeChild(e.firstChild),e.appendChild(document.createElement(n))),t})).catch((function(){e.hasChildNodes()&&e.removeChild(e.firstChild)}))},c=function(e){window.addEventListener("popstate",(function(t){e(window.location.pathname)})),document.addEventListener("routeChanged",(function(t){var n,r=t.detail.route;r&&r.path&&(n=r.path,window.location.href=window.location.href+"#",history&&history.pushState&&history.pushState({},n,n),e(r.path))}))},a=function(e){window.__microfrontendly={};var t=function(e){var t=function(e){if(!e||"string"!=typeof e)throw new Error("Targeted url should be a string.");var t=e.split("/");if(t.length<2)throw new Error("Targeted url is not valid pathname");return"/"+t[1]}(e);window.__microfrontendly.registeredPages[t].forEach((function(e){var t=e.container,n=e.id,r=window.__microfrontendly.registeredApps[n],o=document.getElementById(t);u(o,r)}))},n=function(e){var n,r;return n=e.apps,void 0===r&&(r=window),r.__microfrontendly.registeredApps=function(e){return e.reduce((function(e,t){return t.selector&&(e[t.selector]=t),e}),{})}(n),function(e,t){void 0===t&&(t=window),t.__microfrontendly.registeredPages=function(e){return e.reduce((function(e,t){return t.path&&(e[t.path]=t.apps),e}),{})}(e)}(e.pages),t(window.location.pathname),c(t),e},r={configUri:e,container:document.body,withContainer:function(e){return r.container=e,r},listen:function(){return fetch(r.configUri).then((function(e){return e.json()})).then(n)}};return r}}])}));